<div class="add-container">
  <div>
    <h3>Employee Information</h3>
    <span>insert employee information below</span>
  </div>

  <div class="form-container">
    <form [formGroup]="employeeForm">
      <mat-form-field class="employee-field">
        <input
          matInput
          appearance="fill"
          placeholder="Name"
          formControlName="firstName"
        />
        <mat-error
          *ngIf="firstName?.invalid && firstName?.touched"
          class="has-text-danger"
        >
          Please enter a valid first name
        </mat-error>
      </mat-form-field>
      <mat-form-field class="employee-field">
        <input matInput (change)="setEmail()" placeholder="surname" formControlName="lastName" />
        <mat-error
          *ngIf="lastName?.invalid && lastName?.touched"
          class="has-text-danger"
        >
          Please enter a valid second name
        </mat-error>
      </mat-form-field>

      <div>
      <mat-form-field appearance="fill">
        <mat-label>Choose a start date</mat-label>
        <input matInput [matDatepicker]="picker1" formControlName="start_date" (change)="loging()">
        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Choose an end date</mat-label>
        <input matInput [matDatepicker]="picker2" formControlName="end_date">
        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
      </mat-form-field>
    </div>


      <mat-form-field class="employee-field">
        <input matInput placeholder="blank_id" formControlName="blank_id" />
      </mat-form-field>
      <mat-form-field class="employee-field">
        <input matInput placeholder="role" formControlName="role" />
        <mat-error
          *ngIf="role?.invalid && role?.touched"
          class="has-text-danger"
        >
          Please enter a valid employee role
        </mat-error>
      </mat-form-field>

      

      <div formArrayName="departments">
        <div
          *ngFor="let dep of departmentForms.controls; let i = index"
          [formGroupName]="i"
        >
          <mat-select class="employee-field" placeholder="department name" formControlName="dep" >
            <div *ngFor="let d of departments">
              <mat-option [value]="d">{{ d.dept_name }}</mat-option>
            </div>
          </mat-select>
          <button mat-raised-button color="warn" (click)="deleteDepartment(i)">
            Delete
          </button>
        </div>
      </div>
      <div>
        <button mat-flat-button color="green" (click)="addDepartment()">
          Add Department
        </button>
      </div>
      <br/>
      <mat-select class="employee-field" placeholder="Store Name" (change)="changeStore($event)" formControlName="store">
        <div *ngFor="let s of stores; let i = index">
          <mat-option [value]="s" >{{ s.store_name }}</mat-option>
        </div>
      </mat-select>


      <mat-form-field class = "employee-field">
        <input
           placeholder = "manager name"
           matInput 
           formControlName = "manager"
           [matAutocomplete] = "auto"
           
          >
        <mat-autocomplete #auto = "matAutocomplete">
           <mat-option *ngFor = "let employee of filteredEmployees | async" [value] = "employee.emp_id + ' ' + employee.emp_name">
              {{employee.emp_name}}  {{employee.emp_surname }} with id: {{employee.emp_id}}
           </mat-option>
        </mat-autocomplete>
     </mat-form-field>


      <mat-form-field class="employee-field">
        <input matInput placeholder="email" formControlName="email" />
        <mat-error
          *ngIf="email?.invalid && email?.touched"
          class="has-text-danger"
        >
          Please enter a valid email
        </mat-error>
      </mat-form-field>
      <mat-form-field class="employee-field">
        <input matInput placeholder="mobile" formControlName="mobile" />
        <mat-error
          *ngIf="mobile?.invalid && mobile?.touched"
          class="has-text-danger"
        >
          Please enter a valid mobile number
        </mat-error>
      </mat-form-field>

      <div>
      <button mat-flat-button class="save-btn" (click)="saveEmployee()">
        Save
      </button>
    </div>
    </form>
  </div>
</div>
